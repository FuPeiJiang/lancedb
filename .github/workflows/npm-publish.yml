name: NPM Publish
on: [push]

jobs:
  node-linux:
    name: vectordb (${{ matrix.config.arch}}-unknown-linux-musl)
    runs-on: ${{ matrix.config.runner }}
    container: ${{ matrix.config.container }}
    strategy:
      fail-fast: false
      matrix:
        config:
          - arch: x86_64
            runner: ubuntu-latest
            container: alpine:edge
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Install Dependencies and Build
        run: |
            apk add bash npm protobuf-dev rustup gcc musl-dev
            rustup-init -y --default-toolchain nightly
            source "$HOME/.cargo/env"
            bash ci/manylinux_node/build_vectordb.sh ${{ matrix.config.arch }}
      - name: Upload Linux Artifacts
        uses: actions/upload-artifact@v4
        with:
          name: node-native-linux-${{ matrix.config.arch }}
          path: |
            node/dist/lancedb-vectordb-linux*.tgz